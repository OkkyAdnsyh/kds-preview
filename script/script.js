const orderData = {
    order : [
        {
            number : 202310625,
            name : "Sophia",
            time : "02:28:24 PM",
            type : "To Go",
            orderCode : "to-go",
            cancel : true,
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                        {
                            qty : 1,
                            name : "Espresso"
                        },
                        {
                            qty : 4,
                            name : "Raita"
                        },
                        {
                            qty : 2,
                            name : "Americano"
                        },
                        {
                            qty : 3,
                            name : "Cortado",
                            req : [
                                "Cinnamon",
                                "Cocoa Powder"
                            ]
                        },
                    ]
                }
            ],
        },
        {
            number : 202310626,
            name : "Benjamin",
            time : "02:28:24 PM",
            type : "Delivery",
            orderCode : "delivery",
            instruction : "Extra Cheese and Extra Pickles! Also make it spicy.",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                    ]
                },
                {
                    id : 2,
                    order : [
                        {
                            qty : 1,
                            name : "Espresso"
                        },
                        {
                            qty : 4,
                            name : "Raita"
                        },
                        {
                            qty : 2,
                            name : "Americano"
                        },
                        {
                            qty : 3,
                            name : "Flat White",
                        },
                    ]
                }
            ],
        },
        {
            number : 202310627,
            name : "Ethan",
            time : "02:28:24 PM",
            type : "For Here",
            orderCode : "for-here",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                    ]
                }
            ],
        },
        {
            number : 202310628,
            name : "William",
            time : "02:28:24 PM",
            type : "Pick Up",
            orderCode : "pick-up",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                    ]
                },
                {
                    id : 2,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                        {
                            qty : 4,
                            name : "Raita"
                        },
                        {
                            qty : 2,
                            name : "Americano"
                        },
                        {
                            qty : 3,
                            name : "Cortado",
                            req : [
                                "Cinnamon",
                                "Cocoa Powder"
                            ]
                        },
                    ]
                },
            ],
        },
        {
            number : 202310629,
            name : "Sophia",
            time : "02:28:24 PM",
            type : "Curb Side",
            orderCode : "curb-side",
            instruction : "Extra Cheese and Extra Pickles! Also make it spicy.",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                        {
                            qty : 1,
                            name : "Espresso"
                        },
                        {
                            qty : 4,
                            name : "Raita"
                        },
                        {
                            qty : 2,
                            name : "Americano"
                        },
                        {
                            qty : 3,
                            name : "Cortado",
                            req : [
                                "Cinnamon",
                                "Cocoa Powder"
                            ]
                        },
                    ]
                }
            ],
        },
        {
            number : 202310630,
            name : "Benjamin",
            time : "02:28:24 PM",
            type : "Drive Thru",
            orderCode : "drive-thru",
            instruction : "Extra Cheese and Extra Pickles! Also make it spicy.",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                    ]
                },
                {
                    id : 2,
                    order : [
                        {
                            qty : 1,
                            name : "Espresso"
                        },
                        {
                            qty : 4,
                            name : "Raita"
                        },
                        {
                            qty : 2,
                            name : "Americano"
                        },
                        {
                            qty : 3,
                            name : "Flat White",
                        },
                    ]
                }
            ],
        },
        {
            number : 202310631,
            name : "Ethan",
            time : "02:28:24 PM",
            type : "Delivery",
            orderCode : "delivery",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                    ]
                }
            ],
        },
        {
            number : 202310632,
            name : "William",
            time : "02:28:24 PM",
            type : "To Go",
            orderCode : "to-go",
            category : [
                {
                    id : 1,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                    ]
                },
                {
                    id : 2,
                    order : [
                        {
                            qty : 1,
                            name : "Capuccino"
                        },
                        {
                            qty : 2,
                            name : "Latte",
                            req : [
                                "Whipped Cream"
                            ]
                        },
                        {
                            qty : 4,
                            name : "Raita"
                        },
                        {
                            qty : 2,
                            name : "Americano"
                        },
                        {
                            qty : 3,
                            name : "Cortado",
                            req : [
                                "Cinnamon",
                                "Cocoa Powder"
                            ]
                        },
                    ]
                },
            ],
        },
    ]
}

const orderWrap = document.querySelectorAll('.order-wrapper');
const timeline = document.querySelector('.timeline');
let card = '';
let cardHead = '';
let cardBody = '';
let orderContainer = '';
let orderItem = '';
let orderCat ='';
let orderReq = '';
let orderTimeline = '';
let closingTimer = 5;

for(let i = 0; i < orderData.order.length; i++){

    // loop through order category
    for(let j = 0; j < orderData.order[i].category.length; j++){
        // loop through order
        for(let k = 0; k < orderData.order[i].category[j].order.length; k++){
           // check if order has requierments
            if('req' in orderData.order[i].category[j].order[k]){
                for(let l = 0; l < orderData.order[i].category[j].order[k].req.length; l++){
                    orderReq += `
                        <p class="special">${orderData.order[i].category[j].order[k].req[l]}</p>
                    `
                };
                orderItem += `
                <section class="order" id="order-${orderData.order[i].number}-${k}">
                    <section class="product-container">
                        <p class="product-qty">${orderData.order[i].category[j].order[k].qty}</p>
                        <section class="product">
                            <p class="product-name">${orderData.order[i].category[j].order[k].name}</p>
                            ${orderReq}
                        </section>
                    </section>
                    <section class="checkmark">
                        <svg width="15" height="13" viewBox="0 0 9 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 0.736018L2.82857 7L0 4.12901L0.725143 3.39299L2.82857 5.52274L8.27486 0L9 0.736018Z" fill="#006666"/>
                            </svg>                                            
                        <input type="radio" name="" id="" data-target="#order-${orderData.order[i].number}-${k}" class="order-check">                                         
                    </section>
                </section>
                `
                orderReq = '';
            }else{
                orderItem += `
                <section class="order" id="order-${orderData.order[i].number}-${k}">
                    <section class="product-container">
                        <p class="product-qty">${orderData.order[i].category[j].order[k].qty}</p>
                        <section class="product">
                            <p class="product-name">${orderData.order[i].category[j].order[k].name}</p>
                        </section>
                    </section>
                    <section class="checkmark">
                        <svg width="15" height="13" viewBox="0 0 9 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 0.736018L2.82857 7L0 4.12901L0.725143 3.39299L2.82857 5.52274L8.27486 0L9 0.736018Z" fill="#006666"/>
                            </svg>                                            
                        <input type="radio" name="" id="" data-target="#order-${orderData.order[i].number}-${k}" class="order-check">                                         
                    </section>
                </section>
                `
            }
        }

        
        orderCat += `
        <section class="order-cat">
            <p>category ${orderData.order[i].category[j].id} :</p>
        </section>
        <section class="order-body">
            ${orderItem}
        </section>
        `

        orderItem = '';
    }

    if('instruction' in orderData.order[i]){
        orderContainer = `
            <section class="order-container">
                ${orderCat}
                <section class="req-container">
                    <h3>special instructions</h3>
                    <p>
                        ${orderData.order[i].instruction}
                    </p>
                </section>
            </section>
        `
    }else{
        orderContainer = `
        <section class="order-container">
            ${orderCat}
        </section>
        `
    }
    
    orderCat ='';

    
    if('cancel' in orderData.order[i]){

        cardHead = `
        <section class="card-head ${orderData.order[i].orderCode}">
            <section class="order-info">
                <article class="order-info-head">
                    <p class="name">${orderData.order[i].name}</p>
                    <p class="order-number">Order # ${orderData.order[i].number}</p>
                </article>
                <article class="order-info-body">
                    <p class="time">${orderData.order[i].time}</p>
                    <p class="order-timer">00:00:01</p>
                </article>
            </section>
        </section>
        <section class="card-cat ${orderData.order[i].orderCode}">
            <p>${orderData.order[i].type}</p>
        </section>
        <section class="card-prep-btn order-complete">
            <button class="complet-btn"">Order Complete</button>
        </section>
        `;

        cardBody = `    
        <section class="card-body">
            <section class="order-close-overlay" data-target=".card-${orderData.order[i].number}">
                <div>Order Canceled</div>
            </section>
            <section class="closing-overlay" id="closing-${orderData.order[i].number}">
            <section class="closing-container">
                <section class="countdown-container">
                         <svg class="timer-path" width="107" height="107" viewBox="0 0 107 107" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="53.5" cy="53.5" r="53" stroke="black" stroke-opacity="0.5"/>
                        </svg>     
                        <svg class="timer-indicator" width="107" height="101" viewBox="0 0 107 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <mask id="path-1-inside-1_16_760" fill="white">
                            <path d="M107 53.5C107 44.0668 104.506 34.8012 99.7703 26.6427C95.0347 18.4843 88.2262 11.7229 80.035 7.04419C71.8438 2.36547 62.5612 -0.0642701 53.1282 0.00129216C43.6951 0.0668544 34.4472 2.62539 26.3218 7.41752C18.1964 12.2096 11.4826 19.065 6.86089 27.2885C2.23922 35.512 -0.125953 44.8113 0.00516856 54.2436C0.13629 63.676 2.75904 72.906 7.60752 80.9978C12.456 89.0897 19.3578 95.7557 27.6133 100.32L28.4862 98.7413C20.5092 94.3308 13.8401 87.8895 9.15511 80.0705C4.47013 72.2515 1.93582 63.3328 1.80912 54.2186C1.68242 45.1043 3.96783 36.1186 8.43366 28.1724C12.8995 20.2262 19.3869 13.602 27.2383 8.97151C35.0897 4.34099 44.0258 1.86873 53.1407 1.80538C62.2556 1.74202 71.2253 4.08983 79.1402 8.61078C87.0552 13.1317 93.6341 19.6651 98.2099 27.5484C102.786 35.4318 105.196 44.3849 105.196 53.5H107Z"/>
                            </mask>
                            <path d="M107 53.5C107 44.0668 104.506 34.8012 99.7703 26.6427C95.0347 18.4843 88.2262 11.7229 80.035 7.04419C71.8438 2.36547 62.5612 -0.0642701 53.1282 0.00129216C43.6951 0.0668544 34.4472 2.62539 26.3218 7.41752C18.1964 12.2096 11.4826 19.065 6.86089 27.2885C2.23922 35.512 -0.125953 44.8113 0.00516856 54.2436C0.13629 63.676 2.75904 72.906 7.60752 80.9978C12.456 89.0897 19.3578 95.7557 27.6133 100.32L28.4862 98.7413C20.5092 94.3308 13.8401 87.8895 9.15511 80.0705C4.47013 72.2515 1.93582 63.3328 1.80912 54.2186C1.68242 45.1043 3.96783 36.1186 8.43366 28.1724C12.8995 20.2262 19.3869 13.602 27.2383 8.97151C35.0897 4.34099 44.0258 1.86873 53.1407 1.80538C62.2556 1.74202 71.2253 4.08983 79.1402 8.61078C87.0552 13.1317 93.6341 19.6651 98.2099 27.5484C102.786 35.4318 105.196 44.3849 105.196 53.5H107Z" stroke="#42CD9E" stroke-width="2" mask="url(#path-1-inside-1_16_760)"/>
                        </svg>                                           
                        <p class="time">${closingTimer}</p>
                </section>
                <p class="timer-info">
                    Closing...
                </p>
                <button>
                    Press To Undo
                </button>
                </section>
            </section>
            ${orderContainer}
        </section>
    `
    }else{
        cardHead = `
            <section class="card-head ${orderData.order[i].orderCode}">
                <section class="order-info">
                    <article class="order-info-head">
                        <p class="name">${orderData.order[i].name}</p>
                        <p class="order-number">Order # ${orderData.order[i].number}</p>
                    </article>
                    <article class="order-info-body">
                        <p class="time">${orderData.order[i].time}</p>
                        <p class="order-timer">00:00:01</p>
                    </article>
                </section>
            </section>
            <section class="card-cat ${orderData.order[i].orderCode}">
                <p>${orderData.order[i].type}</p>
            </section>
            <section class="card-prep-btn isActive" id="prep-${orderData.order[i].number}">
                <button class="prep-btn" data-target="#order-${orderData.order[i].number}" data-prep="#prep-${orderData.order[i].number}">Start Preparing</button>
            </section>
            <section class="card-prep-btn order-complete">
                <button class="complet-btn"">Order Complete</button>
            </section>
            `;

        cardBody = `    
        <section class="card-body">
            <section class="disable-overlay" id="order-${orderData.order[i].number}"></section>
            <section class="closing-overlay" id="closing-${orderData.order[i].number}">
            <section class="closing-container">
                <section class="countdown-container">
                         <svg class="timer-path" width="107" height="107" viewBox="0 0 107 107" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="53.5" cy="53.5" r="53" stroke="black" stroke-opacity="0.5"/>
                        </svg>     
                        <svg class="timer-indicator" width="107" height="101" viewBox="0 0 107 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <mask id="path-1-inside-1_16_760" fill="white">
                            <path d="M107 53.5C107 44.0668 104.506 34.8012 99.7703 26.6427C95.0347 18.4843 88.2262 11.7229 80.035 7.04419C71.8438 2.36547 62.5612 -0.0642701 53.1282 0.00129216C43.6951 0.0668544 34.4472 2.62539 26.3218 7.41752C18.1964 12.2096 11.4826 19.065 6.86089 27.2885C2.23922 35.512 -0.125953 44.8113 0.00516856 54.2436C0.13629 63.676 2.75904 72.906 7.60752 80.9978C12.456 89.0897 19.3578 95.7557 27.6133 100.32L28.4862 98.7413C20.5092 94.3308 13.8401 87.8895 9.15511 80.0705C4.47013 72.2515 1.93582 63.3328 1.80912 54.2186C1.68242 45.1043 3.96783 36.1186 8.43366 28.1724C12.8995 20.2262 19.3869 13.602 27.2383 8.97151C35.0897 4.34099 44.0258 1.86873 53.1407 1.80538C62.2556 1.74202 71.2253 4.08983 79.1402 8.61078C87.0552 13.1317 93.6341 19.6651 98.2099 27.5484C102.786 35.4318 105.196 44.3849 105.196 53.5H107Z"/>
                            </mask>
                            <path d="M107 53.5C107 44.0668 104.506 34.8012 99.7703 26.6427C95.0347 18.4843 88.2262 11.7229 80.035 7.04419C71.8438 2.36547 62.5612 -0.0642701 53.1282 0.00129216C43.6951 0.0668544 34.4472 2.62539 26.3218 7.41752C18.1964 12.2096 11.4826 19.065 6.86089 27.2885C2.23922 35.512 -0.125953 44.8113 0.00516856 54.2436C0.13629 63.676 2.75904 72.906 7.60752 80.9978C12.456 89.0897 19.3578 95.7557 27.6133 100.32L28.4862 98.7413C20.5092 94.3308 13.8401 87.8895 9.15511 80.0705C4.47013 72.2515 1.93582 63.3328 1.80912 54.2186C1.68242 45.1043 3.96783 36.1186 8.43366 28.1724C12.8995 20.2262 19.3869 13.602 27.2383 8.97151C35.0897 4.34099 44.0258 1.86873 53.1407 1.80538C62.2556 1.74202 71.2253 4.08983 79.1402 8.61078C87.0552 13.1317 93.6341 19.6651 98.2099 27.5484C102.786 35.4318 105.196 44.3849 105.196 53.5H107Z" stroke="#42CD9E" stroke-width="2" mask="url(#path-1-inside-1_16_760)"/>
                        </svg>                                           
                        <p class="time">${closingTimer}</p>
                </section>
                <p class="timer-info">
                    Closing...
                </p>
                <button>
                    Press To Undo
                </button>
                </section>
            </section>
            ${orderContainer}
        </section>
    `
    }
    
    card += `
        <section class="order-card card-${orderData.order[i].orderCode} card-${orderData.order[i].number}">
            ${cardHead}
            ${cardBody}
        </section>
    `;

    orderTimeline += `
        <section class="order">
            <p class="order-name ${orderData.order[i].orderCode} card-${orderData.order[i].number}">Order # ${orderData.order[i].number}</p>
            <p class="order-time">${orderData.order[i].time}</p>
        </section>
    `
};

orderWrap.forEach((wrap) => {
    wrap.insertAdjacentHTML('afterbegin', card);
})
timeline.insertAdjacentHTML('afterbegin', orderTimeline);

const dropToggle = document.querySelectorAll('.drop-toggle');
const filterToggle = document.querySelectorAll('.filter-radio');
const dropdown = document.querySelectorAll('.dropdown');
const optToggle = document.querySelectorAll('.option-toggle');
const orderCheck = document.querySelectorAll('.order-check');
const prepBtn = document.querySelectorAll('.prep-btn');
const layoutToggle = document.querySelectorAll('.opt');
const orderCard = document.querySelectorAll('.order-card');
const infoToggle = document.querySelector('.info-toggle');
const infoModal = document.querySelector('.info-modal');
const closeOrderOverlay = document.querySelector('.order-close-overlay');
let countdown;


const handleOrderCancel = () => {
    let cardCancel = document.querySelector(closeOrderOverlay.dataset.target);
    let timelineCancel = document.querySelector(closeOrderOverlay.dataset.target);

    cardCancel.classList.add('cancel');
    timelineCancel.classList.add('cancel');
};
const handleDropCheck = () => {
    for(let i = 0; i < dropToggle.length; i++){
        if(dropToggle[i].classList.contains('isActive')){
            dropToggle[i].classList.remove('isActive');
            dropdown[i].classList.remove('isActive');
        };
    };
}
const handleDropToggle = (target) => {
    target.classList.toggle('isActive');
};
const handleDropOpen = (target) => {
    let dropdown = document.querySelector(target.dataset.target);
    // check if toggle has isActive class
    if(target.classList.contains('isActive')){
        dropdown.classList.add('isActive');
        return;
    };
    dropdown.classList.remove('isActive');
}
const handleActiveFilter = (target) => {
    let filterButton = document.querySelector(target.dataset.target);
    filterButton.classList.toggle('isActive');
};
const checkOptToggle = () => {
    for(let i = 0; i < optToggle.length; i++){
        optToggle[i].removeAttribute('checked');
        let target = document.querySelector(optToggle[i].dataset.target);
        let toggle = document.querySelector(optToggle[i].dataset.toggle);
        target.classList.remove('isActive');
        toggle.classList.remove('isActive');
    };
};
const handleOrderCheck = (target) => {
    let order = document.querySelector(target.dataset.target);
    let checkmark = order.querySelector('.checkmark');

    order.classList.toggle('isActive');
    checkmark.classList.toggle('isActive');
}
const handlePrepBtn = (target) => {
    let overlay = document.querySelector(target.dataset.target);
    let prep = document.querySelector(target.dataset.prep);

    prep.classList.remove('isActive');
    overlay.classList.add('disable');
};
const handleFinishOrder = (product, productFinish, completeOrder) => {
    if(product.length === productFinish.length){
        completeOrder.classList.add('isActive');
    } return;
};
const handleCompleteOrder = () => {
    countdown = setInterval(() => {
        if(closingTimer === 0){
            clearInterval(countdown);
            closingTimer = 5;
            return;
        } closingTimer--;
    }, 1000)
}

let cancelTimer = setTimeout(() => {
    handleOrderCancel()
}, 5000);

infoToggle.addEventListener('click', () => {
    infoToggle.classList.toggle('isActive');
    infoModal.classList.toggle('isActive');
});
infoModal.addEventListener('click', () => {
    infoToggle.classList.toggle('isActive');
    infoModal.classList.toggle('isActive');
});

prepBtn.forEach((btn) => {
    btn.addEventListener('click', () => {
        handlePrepBtn(btn);
    });
});

optToggle.forEach((toggle) => {
    let target = document.querySelector(toggle.dataset.target);
    let toggleTarget = document.querySelector(toggle.dataset.toggle);
    toggle.addEventListener('click', () => {
        checkOptToggle();
        toggle.setAttribute('checked', true);
        target.classList.toggle('isActive');
        toggleTarget.classList.toggle('isActive');
    });
});

orderCheck.forEach((check) => {
    check.addEventListener('click', () => {
        handleOrderCheck(check);
    });
});

dropToggle.forEach((toggle) => {
    toggle.addEventListener('click', () => {
        if(toggle.classList.contains('isActive')){
            handleDropToggle(toggle);
            handleDropOpen(toggle);
            return;
        }

        handleDropCheck();
        handleDropToggle(toggle);
        handleDropOpen(toggle);
    });
});

filterToggle.forEach((filter) => {
    filter.addEventListener('click', () => {
        handleActiveFilter(filter);
    });
});

orderCard.forEach((card) => {
    let completeOrder = card.querySelector('.order-complete');
    let completeBtn = card.querySelector('.order-complete button');
    let product = card.querySelectorAll('.order');
    let checkmark = card.querySelectorAll('.order-check');
    let closeOverlay = card.querySelector('.closing-overlay');

    checkmark.forEach((check) => {
        check.addEventListener('click', () => {
            let productFinish = card.querySelectorAll('.order.isActive');
            handleFinishOrder(product, productFinish, completeOrder);
        })
    })

    completeBtn.addEventListener('click', () => {
        completeOrder.classList.remove('isActive');
        closeOverlay.classList.add('isActive');
        handleCompleteOrder()
    })

})